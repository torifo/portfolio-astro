# 安定版記録 / Stable Version Record

## 現在の安定版 / Current Stable Version

**バージョン**: `20251217-2041`
**作成日時**: 2025-12-17 20:42:18 JST
**イメージID**: edde34fb40fc
**タグ**: `stable`, `latest`, `20251217-2041`

---

## 解決済み問題 / Resolved Issues

### 1. テーマ切り替え機能の信頼性とパフォーマンス改善
**コミット**: b61d9fe
**修正日**: 2025-12-17

#### 問題点
- ユーザーのテーマ選択がリロード時に保持されない
- API呼び出しの遅延によるテーマ適用の遅れ
- 自動テーマ切り替えが最大30分遅延する
- モバイル/タブレットでテーマ選択が一貫して動作しない
- レースコンディションによるアイコン表示の不一致

#### 実装した改善
- ✅ localStorageでテーマ設定を永続化（ページリロード時も設定を保持）
- ✅ APIレスポンスのキャッシュ実装（24時間有効）でAPI呼び出しを削減
- ✅ 初期化イベントを'load'から'DOMContentLoaded'に変更し、高速化
- ✅ テーマチェック間隔を30分から1分に短縮し、自動切り替えをよりリアルタイムに
- ✅ グローバル関数として登録し、複数コンポーネント間で呼び出し可能に
- ✅ 初期テーマを即座に適用してフラッシュ現象を防止
- ✅ モバイル/タブレット版でもテーマ設定を保存するように対応

---

### 2. 手動モード時の日の出・日没時間表示
**コミット**: 3923445
**修正日**: 2025-12-17

#### 問題点
- 手動でライト/ダークモードを選択後、リロードすると日の出・日没時間が表示されなくなる

#### 実装した改善
- ✅ 日の出・日没時間の取得・表示機能をテーマ適用機能から分離
- ✅ updateSunTimes()関数を新規作成（テーマ適用なし）
- ✅ DOMContentLoadedで常にupdateSunTimes()を呼び出し
- ✅ 5分ごとに日の出・日没時間を更新（全モード共通）
- ✅ 1分ごとのテーマ自動切り替えは自動モードのみ実行

---

## 主要機能 / Key Features

### テーマシステム
- **3つのモード**: ライトモード、ダークモード、自動モード（日の出・日没連動）
- **永続化**: localStorageによるユーザー設定の保存
- **キャッシュ**: APIレスポンスの24時間キャッシュ
- **リアルタイム更新**: 1分ごとの自動テーマ切り替え（自動モード時）
- **高速表示**: フラッシュ現象なしの即座なテーマ適用

### デバイス対応
- デスクトップ
- タブレット
- モバイル

---

## 利用可能なDockerイメージタグ / Available Docker Image Tags

| タグ | 説明 | イメージID |
|------|------|-----------|
| `latest` | 最新の安定版 | edde34fb40fc |
| `stable` | 現在の安定版（推奨） | edde34fb40fc |
| `20251217-2041` | 本バージョン | edde34fb40fc |
| `20251217-2004` | 前バージョン | d8f134c78697 |
| `20251217-1643` | 初回テーマ改善版 | fa627865d542 |
| `stable-backup` | 旧安定版バックアップ | 1fd8a18430c4 |
| `20251215-0028` | 旧安定版 | 1fd8a18430c4 |

---

## ロールバック手順 / Rollback Procedure

### この安定版に戻す場合
```bash
./deploy.sh stable
# または
./deploy.sh 20251217-2041
```

### 旧安定版に戻す場合
```bash
./deploy.sh stable-backup
# または
./deploy.sh 20251215-0028
```

---

## デプロイ情報 / Deployment Information

**環境**: VPS (x162-43-88-107)
**ドメイン**: https://portorifo.riumu.net
**コンテナ名**: portfolio-frontend
**ネットワーク**: global-proxy-network

---

## 次の開発予定 / Next Development Plans

- ダミーデータのさらなる修正
- 細かい説明の追加
- コンテンツの充実

---

**記録日時**: 2025-12-17 20:50:00 JST
**記録者**: Claude Code (assisted deployment)
